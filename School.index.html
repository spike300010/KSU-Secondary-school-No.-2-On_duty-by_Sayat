<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Ä—É—à–µ–Ω–∏–π –≤ —à–∫–æ–ª–µ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ Tailwind CDN
        tailwind.config = { theme: { extend: {} } }
    </script>
    <style>
        .chart-bar {
            transition: all 0.5s ease;
        }
        .chart-bar:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }
        .lang-btn {
            transition: all 0.3s ease;
        }
        .lang-btn.active {
            background-color: #4f46e5;
            color: white;
        }
        .trend-line {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawLine 2s ease forwards;
        }
        @keyframes drawLine {
            to { stroke-dashoffset: 0; }
        }
        /* –°–∫—Ä—ã—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ Tailwind */
        #tailwind-cdn-warning {
            display: none !important;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="bg-white rounded-2xl shadow-xl p-4 md:p-8 mb-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h1 class="text-2xl md:text-4xl font-bold text-gray-800 mb-2" data-lang="title">üìö –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Ä—É—à–µ–Ω–∏–π –≤ —à–∫–æ–ª–µ</h1>
                    <p class="text-sm md:text-base text-gray-600" data-lang="subtitle">–°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π —Å –∏—Å—Ç–æ—Ä–∏–µ–π</p>
                </div>
                <div class="flex gap-2 flex-wrap">
                    <div class="flex gap-1 bg-gray-100 rounded-lg p-1">
                        <button onclick="changeLang('ru')" id="langRu" class="lang-btn px-3 py-1 rounded font-medium text-sm">RU</button>
                        <button onclick="changeLang('kz')" id="langKz" class="lang-btn px-3 py-1 rounded font-medium text-sm">KZ</button>
                    </div>
                    <select id="yearSelect" class="px-3 md:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 font-medium text-sm">
                    </select>
                    <button onclick="exportToCSV()" class="flex items-center gap-2 bg-green-600 text-white px-3 md:px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-colors text-sm">
                        <span data-lang="export">üì• –≠–∫—Å–ø–æ—Ä—Ç CSV</span>
                    </button>
                    <button onclick="exportToExcel()" class="flex items-center gap-2 bg-blue-600 text-white px-3 md:px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors text-sm">
                        <span data-lang="exportExcel">üìä –≠–∫—Å–ø–æ—Ä—Ç Excel</span>
                    </button>
                    <button onclick="clearAllData()" class="flex items-center gap-2 bg-red-600 text-white px-3 md:px-4 py-2 rounded-lg font-medium hover:bg-red-700 transition-colors text-sm">
                        <span data-lang="clear">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6">
            <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                <div class="flex items-center justify-between mb-2">
                    <h3 class="text-sm md:text-base text-gray-600 font-medium" data-lang="totalStudentsLabel">–í—Å–µ–≥–æ —É—á–µ–Ω–∏–∫–æ–≤</h3>
                    <span class="text-xl md:text-2xl">üë•</span>
                </div>
                <p class="text-3xl md:text-4xl font-bold text-gray-800" id="totalStudents">105</p>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                <div class="flex items-center justify-between mb-2">
                    <h3 class="text-sm md:text-base text-gray-600 font-medium"><span data-lang="violationsIn">–ù–∞—Ä—É—à–µ–Ω–∏–π –≤</span> <span id="currentYear"></span></h3>
                    <span class="text-xl md:text-2xl">‚ö†Ô∏è</span>
                </div>
                <p class="text-3xl md:text-4xl font-bold text-gray-800" id="totalViolations">0</p>
                <p class="text-xs md:text-sm text-gray-500 mt-1"><span data-lang="allTime">–í—Å–µ–≥–æ –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è:</span> <span id="allTimeViolations">0</span></p>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                <div class="flex items-center justify-between mb-2">
                    <h3 class="text-sm md:text-base text-gray-600 font-medium" data-lang="percentageLabel">–ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π</h3>
                    <span class="text-xl md:text-2xl">üìä</span>
                </div>
                <p class="text-3xl md:text-4xl font-bold" id="percentage">0%</p>
                <p class="text-xs md:text-sm text-gray-500 mt-1" id="percentageDetails">0 <span data-lang="outOf">–∏–∑</span> 105 <span data-lang="students">—É—á–µ–Ω–∏–∫–æ–≤</span></p>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                <div class="flex items-center justify-between mb-2">
                    <h3 class="text-sm md:text-base text-gray-600 font-medium" data-lang="avgPerStudent">–°—Ä–µ–¥–Ω–µ–µ –Ω–∞ —É—á–µ–Ω–∏–∫–∞</h3>
                    <span class="text-xl md:text-2xl">üìà</span>
                </div>
                <p class="text-3xl md:text-4xl font-bold text-purple-600" id="avgViolations">0</p>
                <p class="text-xs md:text-sm text-gray-500 mt-1"><span data-lang="median">–ú–µ–¥–∏–∞–Ω–∞:</span> <span id="medianViolations">0</span></p>
            </div>
        </div>

        <!-- –ü–æ–∏—Å–∫ —É—á–µ–Ω–∏–∫–∞ -->
        <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 mb-6">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4" data-lang="searchTitle">üîç –ü–æ–∏—Å–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —É—á–µ–Ω–∏–∫—É</h2>
            <div class="flex flex-col sm:flex-row gap-3">
                <input type="text" id="searchInput" data-lang-placeholder="searchPlaceholder" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —É—á–µ–Ω–∏–∫–∞" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                <button onclick="showStudentStats()" class="bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors whitespace-nowrap">
                    <span data-lang="showStats">–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</span>
                </button>
            </div>
            <div id="studentStatsContainer" class="mt-6"></div>
        </div>

        <!-- –ì—Ä–∞—Ñ–∏–∫ –ø–æ –º–µ—Å—è—Ü–∞–º -->
        <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 mb-6">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4"><span data-lang="monthlyChart">üìÖ –î–∏–Ω–∞–º–∏–∫–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π –ø–æ –º–µ—Å—è—Ü–∞–º</span> (<span id="chartYear"></span>)</h2>
            <div id="monthlyChart" class="flex items-end justify-between h-48 gap-1 md:gap-2"></div>
        </div>

        <!-- –¢—Ä–µ–Ω–¥ –∏ –ø—Ä–æ–≥–Ω–æ–∑ -->
        <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 mb-6">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4"><span data-lang="trendChart">üìà –¢—Ä–µ–Ω–¥ –∏ –ø—Ä–æ–≥–Ω–æ–∑</span> (<span class="trendYear"></span>)</h2>
            <div id="trendChart" class="w-full overflow-x-auto" style="min-height: 250px;"></div>
            <div id="trendStats" class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4"></div>
        </div>

        <!-- –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –∏ –¢–æ–ø-5 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6 mb-6">
            <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4"><span data-lang="pieChart">ü•ß –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞</span> (<span class="pieYear"></span>)</h2>
                <div id="pieChart" class="flex flex-col items-center"></div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4"><span data-lang="topViolators">üèÜ –¢–æ–ø-5 –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π</span> (<span class="topYear"></span>)</h2>
                <div id="topViolators"></div>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6 mb-6">
            <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4" data-lang="addViolation">‚è∞ –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-lang="studentName">–ò–º—è —É—á–µ–Ω–∏–∫–∞</label>
                        <input type="text" id="studentName" data-lang-placeholder="studentNamePlaceholder" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-lang="violationType">–¢–∏–ø –Ω–∞—Ä—É—à–µ–Ω–∏—è</label>
                        <select id="violationType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option data-lang="viol1">–û–ø–æ–∑–¥–∞–Ω–∏–µ</option>
                            <option data-lang="viol2">–ü—Ä–æ–≥—É–ª</option>
                            <option data-lang="viol3">–ù–∞—Ä—É—à–µ–Ω–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã</option>
                            <option data-lang="viol4">–ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –î–ó</option>
                            <option data-lang="viol5">–ù–∞—Ä—É—à–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã</option>
                            <option data-lang="viol6">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞</option>
                            <option data-lang="viol7">–î—Ä—É–≥–æ–µ</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-lang="date">–î–∞—Ç–∞</label>
                            <input type="date" id="violationDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-lang="time">–í—Ä–µ–º—è</label>
                            <input type="time" id="violationTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                    </div>

                    <button onclick="addViolation()" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors">
                        <span data-lang="addButton">–î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ</span>
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4"><span data-lang="typeStats">üìã –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º</span> (<span class="statsYear"></span>)</h2>
                <div id="typeStats"></div>
            </div>
        </div>

        <!-- –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ -->
        <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 mb-6">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4"><span data-lang="correlationMatrix">üîó –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è: –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ vs —Ç–∏–ø –Ω–∞—Ä—É—à–µ–Ω–∏—è</span> (<span class="corrYear"></span>)</h2>
            <div id="correlationMatrix" class="overflow-x-auto"></div>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏–π -->
        <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4"><span data-lang="history">üìú –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏–π</span> (<span class="historyYear"></span>)</h2>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b-2 border-gray-200">
                            <th class="text-left py-3 px-2 md:px-4 font-semibold text-gray-700 text-sm" data-lang="date">–î–∞—Ç–∞</th>
                            <th class="text-left py-3 px-2 md:px-4 font-semibold text-gray-700 text-sm" data-lang="time">–í—Ä–µ–º—è</th>
                            <th class="text-left py-3 px-2 md:px-4 font-semibold text-gray-700 text-sm" data-lang="studentName">–£—á–µ–Ω–∏–∫</th>
                            <th class="text-left py-3 px-2 md:px-4 font-semibold text-gray-700 text-sm" data-lang="violationType">–¢–∏–ø –Ω–∞—Ä—É—à–µ–Ω–∏—è</th>
                            <th class="text-right py-3 px-2 md:px-4 font-semibold text-gray-700 text-sm" data-lang="action">–î–µ–π—Å—Ç–≤–∏–µ</th>
                        </tr>
                    </thead>
                    <tbody id="historyTable"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ========== –î–ê–ù–ù–´–ï ==========
        let violations = [];
        let totalStudents = 105;
        let selectedYear = new Date().getFullYear();
        let currentLang = 'ru';

        // ========== –ü–ï–†–ï–í–û–î–´ ==========
        const translations = {
            ru: {
                title: 'üìö –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Ä—É—à–µ–Ω–∏–π –≤ —à–∫–æ–ª–µ',
                subtitle: '–°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π —Å –∏—Å—Ç–æ—Ä–∏–µ–π',
                export: 'üì• –≠–∫—Å–ø–æ—Ä—Ç CSV',
                exportExcel: 'üìä –≠–∫—Å–ø–æ—Ä—Ç Excel',
                clear: 'üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å',
                totalStudentsLabel: '–í—Å–µ–≥–æ —É—á–µ–Ω–∏–∫–æ–≤',
                violationsIn: '–ù–∞—Ä—É—à–µ–Ω–∏–π –≤',
                allTime: '–í—Å–µ–≥–æ –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è:',
                percentageLabel: '–ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π',
                avgPerStudent: '–°—Ä–µ–¥–Ω–µ–µ –Ω–∞ —É—á–µ–Ω–∏–∫–∞',
                median: '–ú–µ–¥–∏–∞–Ω–∞:',
                outOf: '–∏–∑',
                students: '—É—á–µ–Ω–∏–∫–æ–≤',
                searchTitle: 'üîç –ü–æ–∏—Å–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —É—á–µ–Ω–∏–∫—É',
                searchPlaceholder: '–í–≤–µ–¥–∏—Ç–µ –∏–º—è —É—á–µ–Ω–∏–∫–∞',
                showStats: '–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É',
                monthlyChart: 'üìÖ –î–∏–Ω–∞–º–∏–∫–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π –ø–æ –º–µ—Å—è—Ü–∞–º',
                trendChart: 'üìà –¢—Ä–µ–Ω–¥ –∏ –ø—Ä–æ–≥–Ω–æ–∑',
                pieChart: 'ü•ß –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞',
                topViolators: 'üèÜ –¢–æ–ø-5 –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π',
                addViolation: '‚è∞ –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ',
                studentName: '–ò–º—è —É—á–µ–Ω–∏–∫–∞',
                studentNamePlaceholder: '–í–≤–µ–¥–∏—Ç–µ –∏–º—è',
                violationType: '–¢–∏–ø –Ω–∞—Ä—É—à–µ–Ω–∏—è',
                date: '–î–∞—Ç–∞',
                time: '–í—Ä–µ–º—è',
                addButton: '–î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ',
                typeStats: 'üìã –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º',
                correlationMatrix: 'üîó –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è: –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ vs —Ç–∏–ø –Ω–∞—Ä—É—à–µ–Ω–∏—è',
                history: 'üìú –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏–π',
                action: '–î–µ–π—Å—Ç–≤–∏–µ',
                delete: '–£–¥–∞–ª–∏—Ç—å',
                year: '–≥–æ–¥',
                violations: '–Ω–∞—Ä—É—à–µ–Ω–∏–π',
                noData: '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è',
                noViolations: '–ù–∞—Ä—É—à–µ–Ω–∏–π –≤',
                yearEmpty: '–≥–æ–¥—É –ø–æ–∫–∞ –Ω–µ—Ç',
                historyEmpty: '–ò—Å—Ç–æ—Ä–∏—è –∑–∞',
                yearEmpty2: '–≥–æ–¥ –ø—É—Å—Ç–∞',
                totalViolations: '–í—Å–µ–≥–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π',
                firstViolation: '–ü–µ—Ä–≤–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ',
                lastViolation: '–ü–æ—Å–ª–µ–¥–Ω–µ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ',
                byYears: '–ü–æ –≥–æ–¥–∞–º:',
                byTypes: '–ü–æ —Ç–∏–ø–∞–º:',
                last10: '–ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –Ω–∞—Ä—É—à–µ–Ω–∏–π:',
                notFound: '–ü–æ –∑–∞–ø—Ä–æ—Å—É',
                notFound2: '–Ω–∞—Ä—É—à–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
                statistics: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:',
                viol1: '–û–ø–æ–∑–¥–∞–Ω–∏–µ',
                viol2: '–ü—Ä–æ–≥—É–ª',
                viol3: '–ù–∞—Ä—É—à–µ–Ω–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã',
                viol4: '–ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –î–ó',
                viol5: '–ù–∞—Ä—É—à–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã',
                viol6: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞',
                viol7: '–î—Ä—É–≥–æ–µ',
                confirmDelete: '–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ?',
                confirmClear: '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?',
                enterName: '–í–≤–µ–¥–∏—Ç–µ –∏–º—è —É—á–µ–Ω–∏–∫–∞!',
                trendGrowing: '–¢—Ä–µ–Ω–¥: –†–æ—Å—Ç',
                trendDecreasing: '–¢—Ä–µ–Ω–¥: –°–Ω–∏–∂–µ–Ω–∏–µ',
                trendStable: '–¢—Ä–µ–Ω–¥: –°—Ç–∞–±–∏–ª—å–Ω—ã–π',
                forecast: '–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Å–ª–µ–¥. –º–µ—Å—è—Ü:',
                changeRate: '–¢–µ–º–ø –∏–∑–º–µ–Ω–µ–Ω–∏–π:',
                perMonth: '–≤ –º–µ—Å—è—Ü',
                monday: '–ü–Ω',
                tuesday: '–í—Ç',
                wednesday: '–°—Ä',
                thursday: '–ß—Ç',
                friday: '–ü—Ç',
                saturday: '–°–±',
                sunday: '–í—Å'
            },
            kz: {
                title: 'üìö –ú–µ–∫—Ç–µ–ø—Ç–µ–≥—ñ –±“±–∑—É—à—ã–ª—ã“õ—Ç–∞—Ä–¥—ã –±–∞“õ—ã–ª–∞—É',
                subtitle: '–¢–∞—Ä–∏—Ö—ã –±–∞—Ä —Ç”ô—Ä—Ç—ñ–ø—Ç—ñ–∫ –±“±–∑—É—à—ã–ª—ã“õ—Ç–∞—Ä–¥—ã –µ—Å–µ–ø–∫–µ –∞–ª—É –∂“Ø–π–µ—Å—ñ',
                export: 'üì• –≠–∫—Å–ø–æ—Ä—Ç CSV',
                exportExcel: 'üìä –≠–∫—Å–ø–æ—Ä—Ç Excel',
                clear: 'üóëÔ∏è –¢–∞–∑–∞–ª–∞—É',
                totalStudentsLabel: '–ë–∞—Ä–ª—ã“õ –æ“õ—É—à—ã–ª–∞—Ä',
                violationsIn: '–ë“±–∑—É—à—ã–ª—ã“õ—Ç–∞—Ä',
                allTime: '–ë–∞—Ä–ª—ã“õ —É–∞“õ—ã—Ç –±–æ–π—ã:',
                percentageLabel: '–ë“±–∑—É—à—ã–ª–∞—Ä –ø–∞–π—ã–∑—ã',
                avgPerStudent: '–û“õ—É—à—ã“ì–∞ –æ—Ä—Ç–∞—à–∞',
                median: '–ú–µ–¥–∏–∞–Ω–∞:',
                outOf: '—ñ—à—ñ–Ω–µ–Ω',
                students: '–æ“õ—É—à—ã',
                searchTitle: 'üîç –û“õ—É—à—ã –±–æ–π—ã–Ω—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞–Ω—ã —ñ–∑–¥–µ—É',
                searchPlaceholder: '–û“õ—É—à—ã–Ω—ã“£ –∞—Ç—ã–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑',
                showStats: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞–Ω—ã –∫”©—Ä—Å–µ—Ç—É',
                monthlyChart: 'üìÖ –ê–π–ª–∞—Ä –±–æ–π—ã–Ω—à–∞ –±“±–∑—É—à—ã–ª—ã“õ—Ç–∞—Ä –¥–∏–Ω–∞–º–∏–∫–∞—Å—ã',
                trendChart: 'üìà –¢—Ä–µ–Ω–¥ –∂”ô–Ω–µ –±–æ–ª–∂–∞–º',
                pieChart: 'ü•ß –î”©“£–≥–µ–ª–µ–∫ –¥–∏–∞–≥—Ä–∞–º–º–∞',
                topViolators: 'üèÜ –¢–æ–ø-5 –±“±–∑—É—à—ã–ª–∞—Ä',
                addViolation: '‚è∞ –ë“±–∑—É—à—ã–ª—ã“õ “õ–æ—Å—É',
                studentName: '–û“õ—É—à—ã–Ω—ã“£ –∞—Ç—ã',
                studentNamePlaceholder: '–ê—Ç—ã–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑',
                violationType: '–ë“±–∑—É—à—ã–ª—ã“õ —Ç“Ø—Ä—ñ',
                date: '–ö“Ø–Ω—ñ',
                time: '–£–∞“õ—ã—Ç—ã',
                addButton: '–ë“±–∑—É—à—ã–ª—ã“õ “õ–æ—Å—É',
                typeStats: 'üìã –¢“Ø—Ä–ª–µ—Ä—ñ –±–æ–π—ã–Ω—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
                correlationMatrix: 'üîó –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è: –∞–ø—Ç–∞ –∫“Ø–Ω—ñ vs –±“±–∑—É—à—ã–ª—ã“õ —Ç“Ø—Ä—ñ',
                history: 'üìú –ë“±–∑—É—à—ã–ª—ã“õ—Ç–∞—Ä —Ç–∞—Ä–∏—Ö—ã',
                action: '”ò—Ä–µ–∫–µ—Ç',
                delete: '–ñ–æ—é',
                year: '–∂—ã–ª',
                violations: '–±“±–∑—É—à—ã–ª—ã“õ—Ç–∞—Ä',
                noData: '–ö”©—Ä—Å–µ—Ç—É “Ø—à—ñ–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä –∂–æ“õ',
                noViolations: '–ë“±–∑—É—à—ã–ª—ã“õ—Ç–∞—Ä',
                yearEmpty: '–∂—ã–ª—ã ”ô–∑—ñ—Ä–≥–µ –∂–æ“õ',
                historyEmpty: '–¢–∞—Ä–∏—Ö',
                yearEmpty2: '–∂—ã–ª –±–æ—Å',
                totalViolations: '–ë–∞—Ä–ª—ã“õ –±“±–∑—É—à—ã–ª—ã“õ—Ç–∞—Ä',
                firstViolation: '–ë—ñ—Ä—ñ–Ω—à—ñ –±“±–∑—É—à—ã–ª—ã“õ',
                lastViolation: '–°–æ“£“ì—ã –±“±–∑—É—à—ã–ª—ã“õ',
                byYears: '–ñ—ã–ª–¥–∞—Ä –±–æ–π—ã–Ω—à–∞:',
                byTypes: '–¢“Ø—Ä–ª–µ—Ä—ñ –±–æ–π—ã–Ω—à–∞:',
                last10: '–°–æ“£“ì—ã 10 –±“±–∑—É—à—ã–ª—ã“õ:',
                notFound: '–°“±—Ä–∞—É –±–æ–π—ã–Ω—à–∞',
                notFound2: '–±“±–∑—É—à—ã–ª—ã“õ—Ç–∞—Ä —Ç–∞–±—ã–ª–º–∞–¥—ã',
                statistics: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:',
                viol1: '–ö–µ—à—ñ–≥—É',
                viol2: '–°–∞–±–∞“õ—Ç—ã –±–æ—Å–∞—Ç—É',
                viol3: '–¢”ô—Ä—Ç—ñ–ø –±“±–∑—É',
                viol4: '“Æ–π –∂“±–º—ã—Å—ã–Ω –æ—Ä—ã–Ω–¥–∞–º–∞—É',
                viol5: '–§–æ—Ä–º–∞ –±“±–∑—É',
                viol6: '–¢–µ–ª–µ—Ñ–æ–Ω –ø–∞–π–¥–∞–ª–∞–Ω—É',
                viol7: '–ë–∞—Å“õ–∞',
                confirmDelete: '–ë“±–ª –±“±–∑—É—à—ã–ª—ã“õ—Ç—ã –∂–æ—é –∫–µ—Ä–µ–∫ –ø–µ?',
                confirmClear: '–ë–∞—Ä–ª—ã“õ –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∂–æ–π“ì—ã“£—ã–∑ –∫–µ–ª–µ—Ç—ñ–Ω—ñ–Ω–µ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ?',
                enterName: '–û“õ—É—à—ã–Ω—ã“£ –∞—Ç—ã–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑!',
                trendGrowing: '–¢—Ä–µ–Ω–¥: ”®—Å—É',
                trendDecreasing: '–¢—Ä–µ–Ω–¥: –¢”©–º–µ–Ω–¥–µ—É',
                trendStable: '–¢—Ä–µ–Ω–¥: –¢“±—Ä–∞“õ—Ç—ã',
                forecast: '–ö–µ–ª–µ—Å—ñ –∞–π“ì–∞ –±–æ–ª–∂–∞–º:',
                changeRate: '”®–∑–≥–µ—Ä—É “õ–∞—Ä“õ—ã–Ω—ã:',
                perMonth: '–∞–π—ã–Ω–∞',
                monday: '–î—Å',
                tuesday: '–°—Å',
                wednesday: '–°—Ä',
                thursday: '–ë—Å',
                friday: '–ñ–º',
                saturday: '–°–Ω',
                sunday: '–ñ—Å'
            }
        };

        const monthNames = {
            ru: ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä', '–ú–∞–π', '–ò—é–Ω', '–ò—é–ª', '–ê–≤–≥', '–°–µ–Ω', '–û–∫—Ç', '–ù–æ—è', '–î–µ–∫'],
            kz: ['“ö–∞“£', '–ê“õ–ø', '–ù–∞—É', '–°”ô—É', '–ú–∞–º', '–ú–∞—É', '–®—ñ–ª', '–¢–∞–º', '“ö—ã—Ä', '“ö–∞–∑', '“ö–∞—Ä', '–ñ–µ–ª']
        };

        const violationColors = {
            '–û–ø–æ–∑–¥–∞–Ω–∏–µ': '#3b82f6',
            '–ö–µ—à—ñ–≥—É': '#3b82f6',
            '–ü—Ä–æ–≥—É–ª': '#ef4444',
            '–°–∞–±–∞“õ—Ç—ã –±–æ—Å–∞—Ç—É': '#ef4444',
            '–ù–∞—Ä—É—à–µ–Ω–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã': '#f59e0b',
            '–¢”ô—Ä—Ç—ñ–ø –±“±–∑—É': '#f59e0b',
            '–ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –î–ó': '#8b5cf6',
            '“Æ–π –∂“±–º—ã—Å—ã–Ω –æ—Ä—ã–Ω–¥–∞–º–∞—É': '#8b5cf6',
            '–ù–∞—Ä—É—à–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã': '#10b981',
            '–§–æ—Ä–º–∞ –±“±–∑—É': '#10b981',
            '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞': '#ec4899',
            '–¢–µ–ª–µ—Ñ–æ–Ω –ø–∞–π–¥–∞–ª–∞–Ω—É': '#ec4899',
            '–î—Ä—É–≥–æ–µ': '#6b7280',
            '–ë–∞—Å“õ–∞': '#6b7280'
        };

        // ========== –°–ú–ï–ù–ê –Ø–ó–´–ö–ê ==========
        function changeLang(lang) {
            currentLang = lang;
            localStorage.setItem('schoolLang', lang);
            
            document.getElementById('langRu').classList.toggle('active', lang === 'ru');
            document.getElementById('langKz').classList.toggle('active', lang === 'kz');
            
            document.querySelectorAll('[data-lang]').forEach(el => {
                const key = el.getAttribute('data-lang');
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });

            document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
                const key = el.getAttribute('data-lang-placeholder');
                if (translations[lang][key]) {
                    el.placeholder = translations[lang][key];
                }
            });

            const select = document.getElementById('violationType');
            const options = select.querySelectorAll('option');
            options.forEach((option, index) => {
                option.textContent = translations[lang][`viol${index + 1}`];
            });

            updateAllStats();
        }

        // ========== –ó–ê–ì–†–£–ó–ö–ê –ò –°–û–•–†–ê–ù–ï–ù–ò–ï ==========
        function loadData() {
            const saved = localStorage.getItem('schoolViolations');
            if (saved) {
                try {
                    violations = JSON.parse(saved);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
                    violations = [];
                }
            }
            const savedLang = localStorage.getItem('schoolLang');
            if (savedLang && (savedLang === 'ru' || savedLang === 'kz')) {
                changeLang(savedLang);
            } else {
                changeLang('ru');
            }
            initializeYears();
            updateAllStats();
        }

        function saveData() {
            try {
                localStorage.setItem('schoolViolations', JSON.stringify(violations));
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', e);
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –í–æ–∑–º–æ–∂–Ω–æ, –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.');
            }
        }

        function initializeYears() {
            const years = [...new Set(violations.map(v => new Date(v.date).getFullYear()))];
            if (years.length === 0) years.push(new Date().getFullYear());
            years.sort((a, b) => b - a);

            const select = document.getElementById('yearSelect');
            select.innerHTML = years.map(year => 
                `<option value="${year}" ${year === selectedYear ? 'selected' : ''}>${year} ${translations[currentLang].year}</option>`
            ).join('');

            select.onchange = (e) => {
                selectedYear = parseInt(e.target.value);
                updateAllStats();
            };
        }

        // ========== –î–û–ë–ê–í–õ–ï–ù–ò–ï –ù–ê–†–£–®–ï–ù–ò–Ø ==========
        function addViolation() {
            const name = document.getElementById('studentName').value.trim();
            const typeSelect = document.getElementById('violationType');
            const type = typeSelect.options[typeSelect.selectedIndex].text;
            const date = document.getElementById('violationDate').value;
            const time = document.getElementById('violationTime').value;

            if (!name) {
                alert(translations[currentLang].enterName);
                return;
            }

            if (!date) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É!');
                return;
            }

            violations.push({
                id: Date.now(),
                studentName: name,
                type: type,
                date: date,
                time: time || '00:00',
                timestamp: new Date().toISOString()
            });

            saveData();
            
            document.getElementById('studentName').value = '';
            const today = new Date().toISOString().split('T')[0];
            const now = new Date().toTimeString().slice(0, 5);
            document.getElementById('violationDate').value = today;
            document.getElementById('violationTime').value = now;

            initializeYears();
            updateAllStats();
        }

        function deleteViolation(id) {
            if (confirm(translations[currentLang].confirmDelete)) {
                violations = violations.filter(v => v.id !== id);
                saveData();
                initializeYears();
                updateAllStats();
            }
        }

        function clearAllData() {
            if (confirm(translations[currentLang].confirmClear)) {
                violations = [];
                localStorage.removeItem('schoolViolations');
                initializeYears();
                updateAllStats();
            }
        }

        // ========== –≠–ö–°–ü–û–†–¢ CSV ==========
        function exportToCSV() {
            if (violations.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!');
                return;
            }

            const csv = [
                ['–î–∞—Ç–∞', '–í—Ä–µ–º—è', '–£—á–µ–Ω–∏–∫', '–¢–∏–ø –Ω–∞—Ä—É—à–µ–Ω–∏—è'],
                ...violations.map(v => [v.date, v.time || '', v.studentName, v.type])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `violations_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // ========== –≠–ö–°–ü–û–†–¢ EXCEL ==========
        function exportToExcel() {
            if (violations.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!');
                return;
            }

            const violationsThisYear = violations.filter(v => 
                new Date(v.date).getFullYear() === selectedYear
            );

            let excel = '–î–∞—Ç–∞\t–í—Ä–µ–º—è\t–£—á–µ–Ω–∏–∫\t–¢–∏–ø –Ω–∞—Ä—É—à–µ–Ω–∏—è\t–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏\t–ú–µ—Å—è—Ü\n';
            violations.forEach(v => {
                const date = new Date(v.date);
                const dayNames = currentLang === 'ru' 
                    ? ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±']
                    : ['–ñ—Å', '–î—Å', '–°—Å', '–°—Ä', '–ë—Å', '–ñ–º', '–°–Ω'];
                const dayOfWeek = dayNames[date.getDay()];
                const month = monthNames[currentLang][date.getMonth()];
                excel += `${v.date}\t${v.time || ''}\t${v.studentName}\t${v.type}\t${dayOfWeek}\t${month}\n`;
            });

            excel += '\n\n–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —É—á–µ–Ω–∏–∫–∞–º\n';
            excel += '–£—á–µ–Ω–∏–∫\t–í—Å–µ–≥–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π\t–í —ç—Ç–æ–º –≥–æ–¥—É\t–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –≤—Å–µ—Ö\n';
            const studentCount = {};
            const studentCountYear = {};
            violations.forEach(v => {
                studentCount[v.studentName] = (studentCount[v.studentName] || 0) + 1;
            });
            violationsThisYear.forEach(v => {
                studentCountYear[v.studentName] = (studentCountYear[v.studentName] || 0) + 1;
            });
            Object.entries(studentCount)
                .sort((a, b) => b[1] - a[1])
                .forEach(([name, count]) => {
                    const yearCount = studentCountYear[name] || 0;
                    const percent = ((count / violations.length) * 100).toFixed(1);
                    excel += `${name}\t${count}\t${yearCount}\t${percent}%\n`;
                });

            excel += '\n\n–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –Ω–∞—Ä—É—à–µ–Ω–∏–π\n';
            excel += '–¢–∏–ø –Ω–∞—Ä—É—à–µ–Ω–∏—è\t–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ\t–ü—Ä–æ—Ü–µ–Ω—Ç\n';
            const typeCount = {};
            violationsThisYear.forEach(v => {
                typeCount[v.type] = (typeCount[v.type] || 0) + 1;
            });
            Object.entries(typeCount)
                .sort((a, b) => b[1] - a[1])
                .forEach(([type, count]) => {
                    const percent = violationsThisYear.length > 0 ? ((count / violationsThisYear.length) * 100).toFixed(1) : 0;
                    excel += `${type}\t${count}\t${percent}%\n`;
                });

            excel += '\n\n–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º\n';
            excel += '–ú–µ—Å—è—Ü\t–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π\n';
            const monthlyStats = {};
            violationsThisYear.forEach(v => {
                const month = new Date(v.date).getMonth();
                monthlyStats[month] = (monthlyStats[month] || 0) + 1;
            });
            monthNames[currentLang].forEach((month, index) => {
                const count = monthlyStats[index] || 0;
                excel += `${month}\t${count}\n`;
            });

            const blob = new Blob(['\ufeff' + excel], { type: 'application/vnd.ms-excel;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `violations_detailed_${new Date().toISOString().split('T')[0]}.xls`;
            link.click();
        }

        // ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–¢–ê–¢–ò–°–¢–ò–ö–ò ==========
        function updateAllStats() {
            const violationsThisYear = violations.filter(v => 
                new Date(v.date).getFullYear() === selectedYear
            );

            document.getElementById('currentYear').textContent = selectedYear;
            document.getElementById('chartYear').textContent = selectedYear;
            document.querySelectorAll('.pieYear, .topYear, .statsYear, .historyYear, .trendYear, .corrYear').forEach(el => {
                el.textContent = selectedYear;
            });

            document.getElementById('totalViolations').textContent = violationsThisYear.length;
            document.getElementById('allTimeViolations').textContent = violations.length;

            const uniqueStudents = new Set(violationsThisYear.map(v => v.studentName)).size;
            const percentage = totalStudents > 0 ? ((uniqueStudents / totalStudents) * 100).toFixed(1) : 0;
            
            const percentageEl = document.getElementById('percentage');
            percentageEl.textContent = percentage + '%';
            percentageEl.className = 'text-3xl md:text-4xl font-bold ' + getColorClass(percentage);
            
            document.getElementById('percentageDetails').innerHTML = `${uniqueStudents} ${translations[currentLang].outOf} ${totalStudents} ${translations[currentLang].students}`;

            updateAvgMedian(violationsThisYear);
            updateMonthlyChart(violationsThisYear);
            updateTrendChart(violationsThisYear);
            updatePieChart(violationsThisYear);
            updateTopViolators(violationsThisYear);
            updateTypeStats(violationsThisYear);
            updateCorrelationMatrix(violationsThisYear);
            updateHistoryTable(violationsThisYear);
        }

        function getColorClass(percent) {
            if (percent < 10) return 'text-green-600';
            if (percent < 25) return 'text-yellow-600';
            return 'text-red-600';
        }

        // ========== –°–†–ï–î–ù–ï–ï –ò –ú–ï–î–ò–ê–ù–ê ==========
        function updateAvgMedian(violationsYear) {
            const studentCount = {};
            violationsYear.forEach(v => {
                studentCount[v.studentName] = (studentCount[v.studentName] || 0) + 1;
            });

            const counts = Object.values(studentCount);
            if (counts.length === 0) {
                document.getElementById('avgViolations').textContent = '0';
                document.getElementById('medianViolations').textContent = '0';
                return;
            }

            const avg = (counts.reduce((a, b) => a + b, 0) / counts.length).toFixed(1);
            
            counts.sort((a, b) => a - b);
            let median;
            if (counts.length % 2 === 0) {
                median = ((counts[counts.length / 2 - 1] + counts[counts.length / 2]) / 2).toFixed(1);
            } else {
                median = counts[Math.floor(counts.length / 2)];
            }

            document.getElementById('avgViolations').textContent = avg;
            document.getElementById('medianViolations').textContent = median;
        }

        // ========== –ì–†–ê–§–ò–ö –ü–û –ú–ï–°–Ø–¶–ê–ú ==========
        function updateMonthlyChart(violationsYear) {
            const monthlyStats = {};
            violationsYear.forEach(v => {
                const month = new Date(v.date).getMonth();
                monthlyStats[month] = (monthlyStats[month] || 0) + 1;
            });

            const maxCount = Math.max(...Object.values(monthlyStats), 1);
            const months = monthNames[currentLang];
            
            const chartHTML = months.map((month, index) => {
                const count = monthlyStats[index] || 0;
                const height = (count / maxCount) * 100;
                
                return `
                    <div class="flex-1 flex flex-col items-center">
                        <div class="text-xs md:text-sm font-bold text-indigo-600 mb-1">${count || ''}</div>
                        <div class="chart-bar w-full bg-gradient-to-t from-indigo-600 to-indigo-400 rounded-t" 
                             style="height: ${height}%; min-height: ${count > 0 ? '20px' : '0'}"></div>
                        <div class="text-xs text-gray-600 mt-2">${month}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('monthlyChart').innerHTML = chartHTML;
        }

        // ========== –¢–†–ï–ù–î –ò –ü–†–û–ì–ù–û–ó ==========
        function updateTrendChart(violationsYear) {
            const monthlyData = Array(12).fill(0);
            violationsYear.forEach(v => {
                const month = new Date(v.date).getMonth();
                monthlyData[month]++;
            });

            const n = 12;
            let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;
            
            for (let i = 0; i < n; i++) {
                sumX += i;
                sumY += monthlyData[i];
                sumXY += i * monthlyData[i];
                sumX2 += i * i;
            }

            const denominator = (n * sumX2 - sumX * sumX);
            const m = denominator !== 0 ? (n * sumXY - sumX * sumY) / denominator : 0;
            const b = n > 0 ? (sumY - m * sumX) / n : 0;

            const forecast = Math.max(0, Math.round(m * 12 + b));

            let trendText, trendColor;
            if (m > 0.5) {
                trendText = translations[currentLang].trendGrowing;
                trendColor = 'text-red-600';
            } else if (m < -0.5) {
                trendText = translations[currentLang].trendDecreasing;
                trendColor = 'text-green-600';
            } else {
                trendText = translations[currentLang].trendStable;
                trendColor = 'text-blue-600';
            }

            const maxVal = Math.max(...monthlyData, forecast, 1);
            const scaleY = 200 / maxVal;
            const scaleX = 80;

            let dataPoints = '';
            let trendLine = '';
            
            for (let i = 0; i < 12; i++) {
                const x = 50 + i * scaleX;
                const y = 220 - monthlyData[i] * scaleY;
                dataPoints += `<circle cx="${x}" cy="${y}" r="5" fill="#4f46e5"/>`;
                if (monthlyData[i] > 0) {
                    dataPoints += `<text x="${x}" y="${y - 10}" text-anchor="middle" font-size="12" fill="#4f46e5">${monthlyData[i]}</text>`;
                }
            }

            const x1 = 50;
            const y1 = 220 - (m * 0 + b) * scaleY;
            const x2 = 50 + 11 * scaleX;
            const y2 = 220 - (m * 11 + b) * scaleY;
            trendLine = `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="#ef4444" stroke-width="2" stroke-dasharray="5,5" class="trend-line"/>`;

            const forecastX = 50 + 12 * scaleX;
            const forecastY = 220 - forecast * scaleY;
            const forecastPoint = `<circle cx="${forecastX}" cy="${forecastY}" r="6" fill="#10b981" stroke="white" stroke-width="2"/>`;
            const forecastText = `<text x="${forecastX}" y="${forecastY - 12}" text-anchor="middle" font-size="12" fill="#10b981" font-weight="bold">${forecast}</text>`;

            document.getElementById('trendChart').innerHTML = `
                <svg width="100%" height="250" viewBox="0 0 1100 250" preserveAspectRatio="xMidYMid meet">
                    <line x1="50" y1="220" x2="1050" y2="220" stroke="#e5e7eb" stroke-width="2"/>
                    ${trendLine}
                    ${dataPoints}
                    ${forecastPoint}
                    ${forecastText}
                </svg>
            `;

            document.getElementById('trendStats').innerHTML = `
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-600">${translations[currentLang].trendGrowing.split(':')[0]}</p>
                    <p class="text-xl font-bold ${trendColor}">${trendText.split(':')[1] ? trendText.split(':')[1].trim() : trendText}</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-600">${translations[currentLang].forecast}</p>
                    <p class="text-xl font-bold text-green-600">${forecast}</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-600">${translations[currentLang].changeRate}</p>
                    <p class="text-xl font-bold text-purple-600">${m.toFixed(2)} ${translations[currentLang].perMonth}</p>
                </div>
            `;
        }

        // ========== –ö–†–£–ì–û–í–ê–Ø –î–ò–ê–ì–†–ê–ú–ú–ê ==========
        function updatePieChart(violationsYear) {
            const violationsByType = {};
            violationsYear.forEach(v => {
                violationsByType[v.type] = (violationsByType[v.type] || 0) + 1;
            });

            if (violationsYear.length === 0) {
                document.getElementById('pieChart').innerHTML = `<div class="text-gray-400 py-16">${translations[currentLang].noData}</div>`;
                return;
            }

            const total = violationsYear.length;
            let currentAngle = 0;
            let paths = '';
            let legend = '';

            Object.entries(violationsByType).forEach(([type, count]) => {
                const percentage = (count / total) * 100;
                const angle = (count / total) * 360;
                
                const startAngle = (currentAngle - 90) * (Math.PI / 180);
                const endAngle = (currentAngle + angle - 90) * (Math.PI / 180);
                
                const x1 = 100 + 90 * Math.cos(startAngle);
                const y1 = 100 + 90 * Math.sin(startAngle);
                const x2 = 100 + 90 * Math.cos(endAngle);
                const y2 = 100 + 90 * Math.sin(endAngle);
                const largeArc = angle > 180 ? 1 : 0;

                paths += `<path d="M 100 100 L ${x1} ${y1} A 90 90 0 ${largeArc} 1 ${x2} ${y2} Z" 
                          fill="${violationColors[type]}" stroke="white" stroke-width="2"/>`;
                
                legend += `
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded flex-shrink-0" style="background-color: ${violationColors[type]}"></div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-700 truncate">${type}</p>
                            <p class="text-xs text-gray-500">${count} (${percentage.toFixed(1)}%)</p>
                        </div>
                    </div>
                `;

                currentAngle += angle;
            });

            document.getElementById('pieChart').innerHTML = `
                <svg width="280" height="280" viewBox="0 0 200 200" class="mb-4">
                    <circle cx="100" cy="100" r="90" fill="#f3f4f6" />
                    ${paths}
                    <circle cx="100" cy="100" r="45" fill="white" />
                    <text x="100" y="95" text-anchor="middle" class="text-2xl font-bold" fill="#1f2937">${total}</text>
                    <text x="100" y="115" text-anchor="middle" class="text-xs" fill="#6b7280">${translations[currentLang].violations}</text>
                </svg>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 w-full">${legend}</div>
            `;
        }

        // ========== –¢–û–ü-5 –ù–ê–†–£–®–ò–¢–ï–õ–ï–ô ==========
        function updateTopViolators(violationsYear) {
            const studentCount = {};
            violationsYear.forEach(v => {
                studentCount[v.studentName] = (studentCount[v.studentName] || 0) + 1;
            });

            const top = Object.entries(studentCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            if (top.length === 0) {
                document.getElementById('topViolators').innerHTML = `<div class="text-gray-400 py-16 text-center">${translations[currentLang].noData}</div>`;
                return;
            }

            const maxCount = Math.max(...top.map(v => v[1]));
            
            const html = top.map(([name, count], index) => {
                const width = (count / maxCount) * 100;
                const color = index === 0 ? '#ef4444' : index === 1 ? '#f59e0b' : '#6b7280';
                
                return `
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-1">
                            <div class="flex items-center gap-2 flex-1 min-w-0">
                                <span class="flex items-center justify-center w-6 h-6 rounded-full bg-indigo-100 text-indigo-700 text-sm font-bold flex-shrink-0">
                                    ${index + 1}
                                </span>
                                <span class="font-medium text-gray-700 truncate">${name}</span>
                            </div>
                            <span class="text-sm font-bold text-gray-600 ml-2">${count}</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="h-2.5 rounded-full transition-all duration-500" 
                                 style="width: ${width}%; background-color: ${color}"></div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('topViolators').innerHTML = html;
        }

        // ========== –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û –¢–ò–ü–ê–ú ==========
        function updateTypeStats(violationsYear) {
            const typeCount = {};
            violationsYear.forEach(v => {
                typeCount[v.type] = (typeCount[v.type] || 0) + 1;
            });

            if (Object.keys(typeCount).length === 0) {
                document.getElementById('typeStats').innerHTML = `<p class="text-gray-500 text-center py-8">${translations[currentLang].noViolations} ${selectedYear} ${translations[currentLang].yearEmpty}</p>`;
                return;
            }

            const html = Object.entries(typeCount)
                .sort((a, b) => b[1] - a[1])
                .map(([type, count]) => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors mb-3">
                        <div class="flex items-center gap-3 flex-1 min-w-0">
                            <div class="w-3 h-3 rounded-full flex-shrink-0" style="background-color: ${violationColors[type]}"></div>
                            <span class="font-medium text-gray-700 truncate">${type}</span>
                        </div>
                        <span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full font-bold ml-2">${count}</span>
                    </div>
                `).join('');

            document.getElementById('typeStats').innerHTML = html;
        }

        // ========== –ö–û–†–†–ï–õ–Ø–¶–ò–û–ù–ù–ê–Ø –ú–ê–¢–†–ò–¶–ê ==========
        function updateCorrelationMatrix(violationsYear) {
            if (violationsYear.length === 0) {
                document.getElementById('correlationMatrix').innerHTML = `<p class="text-gray-500 text-center py-8">${translations[currentLang].noData}</p>`;
                return;
            }

            const matrix = {};
            const dayNames = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            const types = [...new Set(violationsYear.map(v => v.type))];
            
            dayNames.forEach(day => {
                matrix[day] = {};
                types.forEach(type => {
                    matrix[day][type] = 0;
                });
            });

            violationsYear.forEach(v => {
                const dayIndex = new Date(v.date).getDay();
                const adjustedIndex = dayIndex === 0 ? 6 : dayIndex - 1;
                const dayKey = dayNames[adjustedIndex];
                matrix[dayKey][v.type]++;
            });

            let maxVal = 0;
            Object.values(matrix).forEach(row => {
                Object.values(row).forEach(val => {
                    if (val > maxVal) maxVal = val;
                });
            });

            let html = '<table class="w-full text-xs md:text-sm"><thead><tr><th class="p-2"></th>';
            types.forEach(type => {
                html += `<th class="p-2 text-center font-semibold text-gray-700"><div class="truncate max-w-[100px]">${type}</div></th>`;
            });
            html += '</tr></thead><tbody>';

            dayNames.forEach(day => {
                const dayLabel = translations[currentLang][day];
                html += `<tr><td class="p-2 font-semibold text-gray-700">${dayLabel}</td>`;
                types.forEach(type => {
                    const count = matrix[day][type];
                    const intensity = maxVal > 0 ? (count / maxVal) : 0;
                    const bgColor = `rgba(79, 70, 229, ${intensity * 0.8})`;
                    const textColor = intensity > 0.5 ? 'white' : '#1f2937';
                    html += `<td class="p-2 md:p-3 text-center font-bold" style="background-color: ${bgColor}; color: ${textColor}">${count || ''}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            document.getElementById('correlationMatrix').innerHTML = html;
        }

        // ========== –ò–°–¢–û–†–ò–Ø ==========
        function updateHistoryTable(violationsYear) {
            if (violationsYear.length === 0) {
                document.getElementById('historyTable').innerHTML = `
                    <tr><td colspan="5" class="text-gray-500 text-center py-8">${translations[currentLang].historyEmpty} ${selectedYear} ${translations[currentLang].yearEmpty2}</td></tr>
                `;
                return;
            }

            const html = violationsYear.slice().reverse().map(v => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-2 md:px-4 text-gray-600 text-sm">${new Date(v.date).toLocaleDateString('ru-RU')}</td>
                    <td class="py-3 px-2 md:px-4 text-gray-600 text-sm">‚è∞ ${v.time || '‚Äî'}</td>
                    <td class="py-3 px-2 md:px-4 font-medium text-gray-800 text-sm">${v.studentName}</td>
                    <td class="py-3 px-2 md:px-4">
                        <span class="inline-flex items-center gap-2 px-2 md:px-3 py-1 rounded-full text-xs md:text-sm font-medium text-white" 
                              style="background-color: ${violationColors[v.type]}">${v.type}</span>
                    </td>
                    <td class="py-3 px-2 md:px-4 text-right">
                        <button onclick="deleteViolation(${v.id})" 
                                class="text-red-600 hover:text-red-800 font-medium transition-colors text-sm">${translations[currentLang].delete}</button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('historyTable').innerHTML = html;
        }

        // ========== –ü–û–ò–°–ö –ü–û –£–ß–ï–ù–ò–ö–£ ==========
        function showStudentStats() {
            const searchName = document.getElementById('searchInput').value.trim();
            if (!searchName) {
                alert(translations[currentLang].enterName);
                return;
            }

            const studentViolations = violations.filter(v => 
                v.studentName.toLowerCase().includes(searchName.toLowerCase())
            );

            if (studentViolations.length === 0) {
                document.getElementById('studentStatsContainer').innerHTML = `
                    <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-center">
                        <p class="text-yellow-800">${translations[currentLang].notFound} "${searchName}" ${translations[currentLang].notFound2}</p>
                    </div>
                `;
                return;
            }

            const byYear = {};
            const byType = {};
            studentViolations.forEach(v => {
                const year = new Date(v.date).getFullYear();
                byYear[year] = (byYear[year] || 0) + 1;
                byType[v.type] = (byType[v.type] || 0) + 1;
            });

            const yearStats = Object.entries(byYear)
                .sort((a, b) => b[0] - a[0])
                .map(([year, count]) => `
                    <div class="flex justify-between items-center mb-2 p-2 bg-gray-50 rounded">
                        <span class="font-medium">${year} ${translations[currentLang].year}</span>
                        <span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full font-bold">${count}</span>
                    </div>
                `).join('');

            const typeStats = Object.entries(byType)
                .sort((a, b) => b[1] - a[1])
                .map(([type, count]) => `
                    <div class="flex justify-between items-center mb-2 p-2 bg-gray-50 rounded">
                        <div class="flex items-center gap-2 flex-1 min-w-0">
                            <div class="w-3 h-3 rounded-full flex-shrink-0" style="background-color: ${violationColors[type]}"></div>
                            <span class="font-medium truncate">${type}</span>
                        </div>
                        <span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full font-bold ml-2">${count}</span>
                    </div>
                `).join('');

            const recentViolations = studentViolations
                .slice(-10)
                .reverse()
                .map(v => `
                    <div class="flex justify-between items-center text-sm mb-2 p-2 bg-gray-50 rounded">
                        <span class="text-gray-600">${new Date(v.date).toLocaleDateString('ru-RU')}</span>
                        <span class="font-medium" style="color: ${violationColors[v.type]}">${v.type}</span>
                    </div>
                `).join('');

            const firstViolation = studentViolations.sort((a, b) => new Date(a.date) - new Date(b.date))[0];
            const lastViolation = studentViolations.sort((a, b) => new Date(b.date) - new Date(a.date))[0];

            document.getElementById('studentStatsContainer').innerHTML = `
                <div class="bg-gradient-to-br from-indigo-50 to-purple-50 border border-indigo-200 rounded-xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold text-gray-800">${searchName}</h3>
                        <div class="bg-white px-4 py-2 rounded-full shadow">
                            <span class="text-3xl font-bold text-indigo-600">${studentViolations.length}</span>
                            <span class="text-sm text-gray-600 ml-2">${translations[currentLang].totalViolations}</span>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-white p-4 rounded-lg shadow">
                            <p class="text-sm text-gray-600 mb-1">${translations[currentLang].firstViolation}</p>
                            <p class="text-lg font-bold text-gray-800">${new Date(firstViolation.date).toLocaleDateString('ru-RU')}</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow">
                            <p class="text-sm text-gray-600 mb-1">${translations[currentLang].lastViolation}</p>
                            <p class="text-lg font-bold text-gray-800">${new Date(lastViolation.date).toLocaleDateString('ru-RU')}</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-4 rounded-lg shadow">
                            <h4 class="font-bold text-gray-700 mb-3">${translations[currentLang].byYears}</h4>
                            ${yearStats}
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow">
                            <h4 class="font-bold text-gray-700 mb-3">${translations[currentLang].byTypes}</h4>
                            ${typeStats}
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow">
                            <h4 class="font-bold text-gray-700 mb-3">${translations[currentLang].last10}</h4>
                            <div class="max-h-64 overflow-y-auto">
                                ${recentViolations}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        window.onload = function() {
            const today = new Date().toISOString().split('T')[0];
            const now = new Date().toTimeString().slice(0, 5);
            document.getElementById('violationDate').value = today;
            document.getElementById('violationTime').value = now;
            
            loadData();
        };
    </script>
</body>
</html>